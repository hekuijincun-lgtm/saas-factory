(()=>{var e={};e.id=729,e.ids=[729],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8612:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>d.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>c,routeModule:()=>b,tree:()=>o}),r(8103),r(1595),r(8714);var a=r(3653),s=r(4966),n=r(6070),d=r.n(n),i=r(2555),l={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);r.d(t,l);let o=["",{children:["admin",{children:["reservations",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,8103)),"C:\\dev\\saas-factory\\apps\\web\\app\\admin\\reservations\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,1595)),"C:\\dev\\saas-factory\\apps\\web\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,8714,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\dev\\saas-factory\\apps\\web\\app\\admin\\reservations\\page.tsx"],x="/admin/reservations/page",m={require:r,loadChunk:()=>Promise.resolve()},b=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/admin/reservations/page",pathname:"/admin/reservations",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},7534:(e,t,r)=>{Promise.resolve().then(r.bind(r,7058))},228:(e,t,r)=>{},7058:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var a=r(2064),s=r(6608),n=r(8620),d=r(3373),i=r(5032),l=r(1236),o=r(8146),c=r(5773);let x=(0,c.Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),m=(0,c.Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var b=r(8048),u=r(2153);r(228);var p=r(8024);function h(){let[e,t]=(0,i.useState)(!1),[r,s]=(0,i.useState)(""),[n,d]=(0,i.useState)(""),[c,h]=(0,i.useState)([]),[f,v]=(0,i.useState)(!1),[g,j]=(0,i.useState)(null),[y,w]=(0,i.useState)(null),[N,k]=(0,i.useState)(null),[S,$]=(0,i.useState)(""),[C,P]=(0,i.useState)(null),[E,I]=(0,i.useState)([]),[_,A]=(0,i.useState)(!1),[D,M]=(0,i.useState)(new Map),[G,q]=(0,i.useState)(null),Z=function(){let e=[];for(let t=10;t<=19;t++)e.push(`${t.toString().padStart(2,"0")}:00`);return e}(),Y=[{id:"any",name:"指名なし",role:void 0,active:!0,sortOrder:0},...E],F=new Map;c.forEach(e=>{let t=e.staffId||"any",r=`${e.date}|${e.time}|${t}`;F.set(r,e)});let L=(0,i.useCallback)(async()=>{v(!0),j(null);try{let e=await (0,l.IF)(n);Array.isArray(e.reservations)?h(e.reservations):(console.warn("fetchReservations: response.reservations is not an array, setting to empty array"),h([]))}catch(e){j(e instanceof o.GY?e.message:e instanceof Error?e.message:"Failed to fetch reservations"),h([])}finally{v(!1)}},[n]),z=e=>{let t=new Date(n);t.setDate(t.getDate()+e),d(t.toISOString().split("T")[0])},O=async e=>{if(window.confirm(`予約をキャンセルしますか？
日付: ${e.date}
時間: ${e.time}
お名前: ${e.name}`)){k(e.reservationId);try{await (0,l.Ml)(e.reservationId),await L(),w(null)}catch(e){if(e instanceof o.GY&&404===e.status)await L(),w(null);else if(e instanceof o.GY&&409===e.status){let t=e.message||"";t.includes("already canceled")||t.includes("既にキャンセル")?(j("既にキャンセル済みです"),await L(),w(null)):j(e.message||"キャンセル期限を過ぎています")}else j(e instanceof o.GY?e.message:e instanceof Error?e.message:"Failed to cancel reservation")}finally{k(null)}}},R=(e,t)=>{let r=`${n}|${e}|${t}`;return F.get(r)},T=e=>e.staffId||"any",B=async()=>{if(y&&S){A(!0),j(null);try{let e=y.reservationId,t="any"===S?null:S;await (0,l.Ip)(e,t),await L(),w(null),$(""),P(null)}catch(e){j(e instanceof o.GY?e.message:e instanceof Error?e.message:"Failed to assign staff")}finally{A(!1)}}};return(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white rounded-2xl shadow-soft border border-brand-border p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("h1",{className:"text-2xl font-semibold text-brand-text",children:"予約台帳"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:()=>z(-1),className:"p-2 text-brand-muted hover:text-brand-text hover:bg-brand-bg rounded-xl transition-all",children:a.jsx(x,{className:"w-5 h-5"})}),a.jsx("div",{className:"px-4 py-2 bg-brand-bg border border-brand-border rounded-xl",children:a.jsx("span",{className:"text-sm font-medium text-brand-text",children:(e=>{let t=new Date(e);return`${t.getFullYear()}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getDate().toString().padStart(2,"0")}(${["日","月","火","水","木","金","土"][t.getDay()]})`})(n)})}),a.jsx("button",{onClick:()=>z(1),className:"p-2 text-brand-muted hover:text-brand-text hover:bg-brand-bg rounded-xl transition-all",children:a.jsx(m,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:()=>{d(r)},className:"px-4 py-2 text-sm font-medium text-brand-text bg-white border border-brand-border rounded-xl hover:shadow-md transition-all",children:"今日"}),(0,a.jsxs)("button",{onClick:()=>{alert("予約作成機能は準備中です")},className:"px-5 py-4 bg-brand-primary text-white rounded-2xl shadow-soft hover:shadow-md transition-all flex items-center gap-2 leading-tight",children:[a.jsx(b.Z,{className:"w-5 h-5"}),a.jsx("span",{className:"font-medium",children:"予約作成"})]})]})]})}),g&&a.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-2xl",children:a.jsx("p",{className:"text-sm text-red-700",children:g})}),a.jsx("div",{className:"bg-white rounded-2xl shadow-soft border border-brand-border overflow-hidden",children:f?(0,a.jsxs)("div",{className:"flex items-center justify-center py-12",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-primary"}),a.jsx("span",{className:"ml-3 text-sm text-brand-muted",children:"読み込み中..."})]}):a.jsx("div",{className:"overflow-auto max-h-[calc(100vh-300px)]",children:(0,a.jsxs)("table",{className:"min-w-full border-collapse",children:[a.jsx("thead",{className:"bg-brand-bg sticky top-0 z-10",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"sticky left-0 z-20 bg-brand-bg border-r border-brand-border px-4 py-3 text-left text-xs font-semibold text-brand-muted uppercase tracking-wider min-w-[80px]",children:"TIME"}),Y.map(e=>a.jsx("th",{className:"border-r border-brand-border px-4 py-3 text-center text-xs font-semibold text-brand-muted uppercase tracking-wider min-w-[200px] last:border-r-0",children:(0,a.jsxs)("div",{children:[a.jsx("div",{className:"font-medium text-brand-text",children:e.name}),e.role&&(0,a.jsxs)("div",{className:"text-xs text-brand-muted mt-1",children:["(",e.role,")"]})]})},e.id))]})}),a.jsx("tbody",{className:"bg-white divide-y divide-brand-border",children:Z.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-brand-bg/50 transition-colors",children:[a.jsx("td",{className:"sticky left-0 z-10 bg-white border-r border-brand-border px-4 py-3 text-sm font-medium text-brand-text min-w-[80px]",children:e}),Y.map(t=>{let r=R(e,t.id),s="any"===t.id||(0,p.wS)(n,e,D.get(t.id)||null);return a.jsx("td",{className:`border-r border-brand-border px-2 py-2 min-w-[200px] last:border-r-0 align-top ${s?"":"bg-gray-100 opacity-50"}`,children:r?(0,a.jsxs)("div",{onClick:()=>s&&w(r),className:`border rounded-xl p-3 transition-all ${s?"bg-blue-50 border-blue-200 cursor-pointer hover:shadow-md":"bg-gray-100 border-gray-200 cursor-not-allowed opacity-50"}`,children:[a.jsx("div",{className:"font-medium text-brand-text text-sm mb-1",children:r.name}),a.jsx("div",{className:"text-xs text-brand-muted mb-2",children:r.phone||"-"}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx(u.Z,{variant:"reserved",children:"予約済み"}),a.jsx("span",{className:"text-xs text-brand-muted font-mono",children:r.reservationId.slice(0,8)})]})]}):a.jsx("div",{className:`h-16 ${s?"":"bg-gray-50"}`})},`${e}-${t.id}`)})]},e))})]})})}),y&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>w(null),children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-soft max-w-2xl w-full p-6 space-y-6",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("h2",{className:"text-2xl font-semibold text-brand-text",children:"予約詳細"}),(0,a.jsxs)("p",{className:"text-sm text-brand-muted mt-1",children:["予約ID: ",y.reservationId]})]}),a.jsx("button",{onClick:()=>w(null),className:"p-2 text-brand-muted hover:text-brand-text hover:bg-brand-bg rounded-lg transition-all",children:a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-brand-muted mb-1",children:"日付"}),a.jsx("p",{className:"text-base text-brand-text",children:y.date})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-brand-muted mb-1",children:"時間"}),a.jsx("p",{className:"text-base text-brand-text",children:y.time})]})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-brand-muted mb-1",children:"お名前"}),a.jsx("p",{className:"text-base text-brand-text",children:y.name})]}),y.phone&&(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-brand-muted mb-1",children:"電話番号"}),a.jsx("p",{className:"text-base text-brand-text",children:y.phone})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-brand-muted mb-1",children:"作成日時"}),a.jsx("p",{className:"text-base text-brand-text",children:e?(()=>{try{return new Date(y.createdAt).toLocaleString("ja-JP")}catch{return y.createdAt}})():y.createdAt})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-brand-muted mb-1",children:"ステータス"}),a.jsx("div",{children:a.jsx(u.Z,{variant:"reserved",children:"予約済み"})})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-brand-muted mb-1",children:"担当者"}),a.jsx("p",{className:"text-base text-brand-text",children:(()=>{let e=T(y);if("any"===e)return"指名なし";let t=E.find(t=>t.id===e);return t?t.name:"指名なし"})()})]}),"any"===T(y)&&(0,a.jsxs)("div",{className:"border-t border-brand-border pt-4 mt-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-brand-text mb-3",children:"担当者を割り当て"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"assign-staff",className:"block text-sm font-medium text-brand-text mb-2",children:"スタッフを選択"}),(0,a.jsxs)("select",{id:"assign-staff",value:S,onChange:e=>$(e.target.value),className:"w-full px-4 py-3 border border-brand-border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:border-brand-primary transition-all bg-white",children:[a.jsx("option",{value:"",children:"選択してください"}),E.filter(e=>{if(!y)return!1;let t=D.get(e.id);return(0,p.wS)(y.date,y.time,t||null)}).map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," ",e.role?`(${e.role})`:""]},e.id))]})]}),a.jsx("button",{onClick:B,disabled:!S,className:"w-full px-4 py-3 bg-brand-primary text-white rounded-xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary focus:ring-offset-2 disabled:bg-brand-muted disabled:cursor-not-allowed transition-all",children:"割り当て"}),a.jsx("p",{className:"text-xs text-brand-muted",children:"※ 現時点では画面表示のみ更新されます。API連携は準備中です。"})]})]})]}),a.jsx("div",{className:"flex items-center gap-2 pt-4 border-t border-brand-border",children:a.jsx("button",{onClick:()=>{w(null),O(y)},disabled:N===y.reservationId,className:"px-4 py-2 text-sm font-medium text-rose-600 bg-rose-50 border border-rose-200 rounded-xl hover:bg-rose-100 focus:outline-none focus:ring-2 focus:ring-rose-500/20 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:N===y.reservationId?"キャンセル中...":"キャンセル"})})]})})]})}function f(){return a.jsx(s.Z,{sidebar:a.jsx(d.Z,{}),topbar:a.jsx(n.Z,{title:"予約管理",subtitle:"予約の一覧と管理を行います。"}),children:a.jsx(h,{})})}r(2988)},2988:(e,t,r)=>{"use strict";r(8146)},8024:(e,t,r)=>{"use strict";function a(e){let[t,r]=e.split(":").map(Number);return 60*t+r}function s(){let e=[];for(let t=10;t<=20;t++)for(let r=0;r<60;r+=30){let a=`${t.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`;e.push(a)}return e}function n(e){let t=s(),r=a(e);return t.filter(e=>a(e)>r)}function d(e){var t,r;if(!e.enabled)return{valid:!0};if(t=e.start,r=e.end,!(a(t)<a(r)))return{valid:!1,error:"終了時刻は開始時刻より後である必要があります"};if(e.breakStart||e.breakEnd){if(!e.breakStart||!e.breakEnd)return{valid:!1,error:"休憩開始時刻と終了時刻の両方を入力してください"};if(!function(e,t,r,s){if(!r||!s)return!0;let n=a(e),d=a(t),i=a(r),l=a(s);return n<i&&i<l&&l<d}(e.start,e.end,e.breakStart,e.breakEnd))return{valid:!1,error:"休憩時間は勤務時間の範囲内である必要があります"}}return{valid:!0}}function i(e){return["日","月","火","水","木","金","土"][e]}function l(e,t,r){if(!r)return!0;let s=new Date(e).getDay(),n=a(t),d=r.exceptions.find(t=>t.date===e);if(d){if("off"===d.type)return!1;if("custom"===d.type&&d.start&&d.end){let e=a(d.start),t=a(d.end);if(d.breakStart&&d.breakEnd){let e=a(d.breakStart),t=a(d.breakEnd);if(n>=e&&n<t)return!1}return n>=e&&n<t}}let i=r.weekly.find(e=>e.dow===s);if(!i||!i.enabled)return!1;let l=a(i.start),o=a(i.end);if(i.breakStart&&i.breakEnd){let e=a(i.breakStart),t=a(i.breakEnd);if(n>=e&&n<t)return!1}return n>=l&&n<o}r.d(t,{Ot:()=>i,Ph:()=>s,YC:()=>n,a$:()=>d,wS:()=>l})},8103:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(1924).createProxy)(String.raw`C:\dev\saas-factory\apps\web\app\admin\reservations\page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[352,494,937,770],()=>r(8612));module.exports=a})();