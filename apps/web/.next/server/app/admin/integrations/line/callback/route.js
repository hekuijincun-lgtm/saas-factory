"use strict";(()=>{var e={};e.id=168,e.ids=[168],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1883:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>g,patchFetch:()=>m,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>u,staticGenerationAsyncStorage:()=>p});var r={};n.r(r),n.d(r,{GET:()=>l});var a=n(7849),i=n(4966),o=n(9169),s=n(1237);async function l(e){let t=new URL(e.url),n=t.searchParams.get("code"),r=t.searchParams.get("state"),a=t.searchParams.get("error"),i=t.searchParams.get("error_description"),o=function(e){if(!e)return"default";let t=e.indexOf(":");return t<=0?"default":e.slice(0,t)||"default"}(r);if(console.log("[line-callback] HIT",{href:t.href,code:n?"(present)":null,state:r,error:a,errorDescription:i,tenantId:o}),a)return s.NextResponse.redirect(new URL(`/admin/settings?line=error&tenantId=${encodeURIComponent(o)}`,t.origin),307);if(!n)return s.NextResponse.redirect(new URL(`/admin/settings?line=missing_code&tenantId=${encodeURIComponent(o)}`,t.origin),307);let l=new URL(`/api/proxy/admin/line/oauth/callback?tenantId=${encodeURIComponent(o)}`,t.origin);console.log("[line-callback] POST proxy",{proxyUrl:l.toString(),tenantId:o});let c=await fetch(l.toString(),{method:"POST",headers:{"content-type":"application/json",accept:"application/json"},cache:"no-store",body:JSON.stringify({code:n,state:r,tenantId:o})}),d=await c.text();return console.log("[line-callback] proxy result",{status:c.status,body:d.slice(0,800)}),s.NextResponse.redirect(new URL(`/admin/settings?line=${c.ok?"linked":"error_exchange"}&tenantId=${encodeURIComponent(o)}`,t.origin),307)}let c=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/admin/integrations/line/callback/route",pathname:"/admin/integrations/line/callback",filename:"route",bundlePath:"app/admin/integrations/line/callback/route"},resolvedPagePath:"C:\\dev\\saas-factory\\apps\\web\\app\\admin\\integrations\\line\\callback\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:u}=c,g="/admin/integrations/line/callback/route";function m(){return(0,o.patchFetch)({serverHooks:u,staticGenerationAsyncStorage:p})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[352,444],()=>n(1883));module.exports=r})();