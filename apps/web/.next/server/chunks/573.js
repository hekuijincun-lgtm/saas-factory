"use strict";exports.id=573,exports.ids=[573],exports.modules={9370:(e,s,t)=>{t.d(s,{default:()=>o});var r=t(2064),a=t(5032),n=t(1236),d=t(8146);function l(e){if(!e)return new Date;if(e instanceof Date)return isNaN(e.getTime())?new Date:e;if("string"==typeof e){if(!e.trim())return new Date;let s=new Date(e);if(!isNaN(s.getTime()))return s;let t=e.match(/^(\d{4})\/(\d{1,2})\/(\d{1,2})$/);if(t){let[,e,s,r]=t,a=new Date(parseInt(e),parseInt(s)-1,parseInt(r));if(!isNaN(a.getTime()))return a}let r=e.match(/^(\d{4})\.(\d{1,2})\.(\d{1,2})$/);if(r){let[,e,s,t]=r,a=new Date(parseInt(e),parseInt(s)-1,parseInt(t));if(!isNaN(a.getTime()))return a}let a=e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);if(a){let[,e,s,t]=a,r=new Date(parseInt(e),parseInt(s)-1,parseInt(t));if(!isNaN(r.getTime()))return r}}return new Date}function i(e){let s=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${s}-${t}-${r}`}function o(){let[e,s]=(0,a.useState)(!1),[t,o]=(0,a.useState)(""),[c,m]=(0,a.useState)(1),[x,u]=(0,a.useState)(""),[b,h]=(0,a.useState)("any"),[f,p]=(0,a.useState)([]),[g,j]=(0,a.useState)([]),[N,y]=(0,a.useState)(null),[v,w]=(0,a.useState)(""),[D,k]=(0,a.useState)(""),[S,C]=(0,a.useState)(!1),[I,$]=(0,a.useState)(null),[F,T]=(0,a.useState)(null),[A,L]=(0,a.useState)(null),[M,Y]=(0,a.useState)(!0),G=async()=>{if(!N||!v.trim()){$("時間と名前を入力してください");return}C(!0),$(null);try{let e=await (0,n.Rr)({date:x,time:N,name:v.trim(),phone:D.trim()||void 0,staffId:"any"!==b?b:null});T(e),$(null),m(6)}catch(e){if(e instanceof d.GY&&409===e.status){$("その枠は埋まりました。別の時間を選択してください。"),m(3);try{let e=await (0,n.FJ)(x,"any"!==b?b:void 0);j(e.slots)}catch(e){console.error("Failed to refresh slots:",e)}}else $(e instanceof d.GY?e.message:e instanceof Error?e.message:"Failed to create reservation")}finally{C(!1)}};return(0,r.jsxs)("div",{className:"space-y-6",children:[r.jsx("div",{className:"flex items-center justify-between mb-6",children:[1,2,3,4,5,6].map(e=>(0,r.jsxs)("div",{className:"flex items-center flex-1",children:[r.jsx("div",{className:`w-8 h-8 rounded-xl flex items-center justify-center text-sm font-medium ${c>=e?"bg-brand-primary text-white":"bg-brand-bg text-brand-muted"}`,children:e}),e<6&&r.jsx("div",{className:`flex-1 h-1 mx-2 rounded ${c>e?"bg-brand-primary":"bg-brand-border"}`})]},e))}),1===c&&r.jsx("div",{className:"space-y-4",children:M?(0,r.jsxs)("div",{className:"flex items-center justify-center py-12",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-primary"}),r.jsx("span",{className:"ml-3 text-sm text-brand-muted",children:"読み込み中..."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"text-lg font-semibold text-brand-text mb-1",children:"予約日を選択"}),r.jsx("p",{className:"text-sm text-brand-muted",children:"ご希望の日付を選択してください"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"date",className:"block text-sm font-medium text-brand-text mb-2",children:"予約日"}),r.jsx("input",{id:"date",type:"date",value:x,onChange:e=>{let s=e.target.value;if(A){let e=l(t),r=l(s),a=A.publicDays??A.rules?.publicDays??0,n=new Date(e);if(n.setDate(e.getDate()+a),isNaN(e.getTime())||isNaN(r.getTime())||isNaN(n.getTime())){$("日付の処理中にエラーが発生しました");return}if(r<e||r>n){$(`予約可能期間は今日から${a}日後までです`);return}let d=r.getDay();if(A.closedWeekdays?.includes(d)){$("選択された日付は定休日です");return}let i=A.exceptions?.find(e=>e.date===s);if(i&&"closed"===i.type){$("選択された日付は休業日です");return}}u(s),$(null)},className:"w-full px-4 py-3 border border-brand-border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:border-brand-primary transition-all",min:e?i(l(t)):void 0,max:e&&A?(()=>{let e=l(t),s=A.publicDays??A.rules?.publicDays??0,r=new Date(e);return(r.setDate(e.getDate()+s),isNaN(r.getTime()))?i(e):i(r)})():void 0}),A&&(0,r.jsxs)("p",{className:"text-xs text-brand-muted mt-1",children:["予約可能期間: 今日から",A.publicDays??A.rules?.publicDays??0,"日後まで"]})]}),I&&r.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-xl",children:r.jsx("p",{className:"text-sm text-red-700",children:I})}),r.jsx("button",{onClick:()=>{x&&m(2)},disabled:!x||!!I,className:"w-full px-4 py-3 bg-brand-primary text-white rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:ring-offset-2 disabled:bg-brand-muted disabled:cursor-not-allowed transition-all",children:"次へ"})]})}),2===c&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"text-lg font-semibold text-brand-text mb-1",children:"スタッフを選択"}),r.jsx("p",{className:"text-sm text-brand-muted",children:"指名なしも選べます（あとで割当可能）"})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("button",{onClick:()=>h("any"),className:`w-full px-4 py-4 rounded-2xl text-left border transition-all ${"any"===b?"bg-white border-brand-primary shadow-md ring-2 ring-brand-primary/20":"bg-white border-brand-border shadow-sm hover:shadow-md hover:border-brand-primary"}`,children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"font-medium text-brand-text",children:"指名なし"}),r.jsx("span",{className:"text-xs px-2 py-0.5 bg-blue-50 text-blue-700 rounded-md",children:"おすすめ"})]}),r.jsx("div",{className:"text-sm text-brand-muted mt-1",children:"後からスタッフを割り当て可能"})]}),f.length>0?f.map(e=>(0,r.jsxs)("button",{onClick:()=>h(e.id),className:`w-full px-4 py-4 rounded-2xl text-left border transition-all ${b===e.id?"bg-white border-brand-primary shadow-md ring-2 ring-brand-primary/20":"bg-white border-brand-border shadow-sm hover:shadow-md hover:border-brand-primary"}`,children:[r.jsx("div",{className:"font-medium text-brand-text",children:e.name}),e.role&&r.jsx("div",{className:"text-sm text-brand-muted mt-1",children:e.role})]},e.id)):r.jsx("div",{className:"text-sm text-brand-muted text-center py-4",children:"スタッフ情報を読み込み中..."})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>m(1),className:"flex-1 px-4 py-3 bg-white text-brand-text border border-brand-border rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:ring-offset-2 transition-all",children:"戻る"}),r.jsx("button",{onClick:()=>{m(3)},className:"flex-1 px-4 py-3 bg-brand-primary text-white rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:ring-offset-2 transition-all",children:"次へ"})]})]}),3===c&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"text-lg font-semibold text-brand-text mb-1",children:"時間を選択"}),r.jsx("p",{className:"text-sm text-brand-muted",children:"ご希望の時間を選択してください"})]}),S&&(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[r.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-brand-primary"}),r.jsx("span",{className:"mt-4 text-sm text-brand-muted",children:"時間枠を取得中..."}),r.jsx("span",{className:"mt-1 text-xs text-brand-muted",children:"しばらくお待ちください"})]}),!S&&I&&(0,r.jsxs)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl",children:[r.jsx("p",{className:"text-sm font-medium text-red-800 mb-1",children:"エラーが発生しました"}),r.jsx("p",{className:"text-sm text-red-700",children:I}),r.jsx("button",{onClick:async()=>{$(null),C(!0);try{let e=await (0,n.FJ)(x,"any"!==b?b:void 0);e&&e.slots&&Array.isArray(e.slots)?j(e.slots):($("スロットデータの形式が不正です"),j([]))}catch(e){$(e instanceof d.GY?e.message:e instanceof Error?e.message:"Failed to fetch slots"),j([])}finally{C(!1)}},className:"mt-3 px-4 py-2 bg-red-100 text-red-700 rounded-lg text-sm font-medium hover:bg-red-200 transition-colors",children:"再試行"})]}),!S&&!I&&0===g.length&&(0,r.jsxs)("div",{className:"p-6 bg-slate-50 border border-slate-200 rounded-xl text-center",children:[r.jsx("p",{className:"text-sm text-brand-muted",children:"選択された日付には予約可能な時間枠がありません"}),r.jsx("p",{className:"text-xs text-brand-muted mt-1",children:"別の日付を選択してください"})]}),!S&&!I&&g.length>0&&(0,r.jsxs)("div",{children:[r.jsx("div",{className:"grid grid-cols-3 gap-2",children:g.map(e=>{let s=!e.available,t={cutoff:"締切",reserved:"予約済",shift:"勤務外/休憩",closed:"休業"};return r.jsx("button",{onClick:()=>!s&&y(e.time),disabled:s,className:`px-4 py-2.5 rounded-2xl text-sm font-medium transition-all border relative ${N===e.time?"bg-white text-brand-text border-brand-primary shadow-md ring-2 ring-brand-primary/20":s?"bg-slate-50 text-brand-muted border-brand-border opacity-60 cursor-not-allowed":"bg-white text-brand-text border-brand-border shadow-sm hover:shadow-md hover:border-brand-primary"}`,children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-0.5",children:[r.jsx("span",{children:e.time}),s&&e.reason&&t[e.reason]&&r.jsx("span",{className:"text-xs text-rose-600 font-normal",children:t[e.reason]})]})},e.time)})}),A&&x===t&&A.rules?.cutoffMinutes&&(0,r.jsxs)("p",{className:"text-xs text-brand-muted mt-2",children:["当日は",A.rules.cutoffMinutes,"分前まで予約可能です"]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>m(2),className:"flex-1 px-4 py-3 bg-white text-brand-text border border-brand-border rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:ring-offset-2 transition-all",children:"戻る"}),r.jsx("button",{onClick:()=>{N&&m(4)},disabled:!N,className:"flex-1 px-4 py-3 bg-brand-primary text-white rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary focus:ring-offset-2 disabled:bg-brand-muted disabled:cursor-not-allowed transition-all",children:"次へ"})]})]}),4===c&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"text-lg font-semibold text-brand-text mb-1",children:"お客様情報"}),r.jsx("p",{className:"text-sm text-brand-muted",children:"予約に必要な情報を入力してください"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"name",className:"block text-sm font-medium text-brand-text mb-2",children:["お名前 ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{id:"name",type:"text",value:v,onChange:e=>w(e.target.value),placeholder:"山田 太郎",className:"w-full px-4 py-3 border border-brand-border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:border-brand-primary transition-all"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-brand-text mb-2",children:"電話番号（任意）"}),r.jsx("input",{id:"phone",type:"tel",value:D,onChange:e=>k(e.target.value),placeholder:"090-1234-5678",className:"w-full px-4 py-3 border border-brand-border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:border-brand-primary transition-all"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>m(3),className:"flex-1 px-4 py-3 bg-white text-brand-text border border-brand-border rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:ring-offset-2 transition-all",children:"戻る"}),r.jsx("button",{onClick:()=>{v.trim()&&m(5)},disabled:!v.trim(),className:"flex-1 px-4 py-3 bg-brand-primary text-white rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary focus:ring-offset-2 disabled:bg-brand-muted disabled:cursor-not-allowed transition-all",children:"次へ"})]})]}),5===c&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"text-lg font-semibold text-brand-text mb-1",children:"予約内容の確認"}),r.jsx("p",{className:"text-sm text-brand-muted",children:"内容をご確認の上、予約を確定してください"})]}),(0,r.jsxs)("div",{className:"bg-slate-50 rounded-lg p-4 space-y-2",children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm font-medium text-slate-700",children:"日付:"})," ",r.jsx("span",{className:"text-sm text-slate-900",children:x})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm font-medium text-slate-700",children:"スタッフ:"})," ",r.jsx("span",{className:"text-sm text-slate-900",children:"any"===b?"指名なし":f.find(e=>e.id===b)?.name||"指名なし"})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm font-medium text-slate-700",children:"時間:"})," ",r.jsx("span",{className:"text-sm text-slate-900",children:N})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm font-medium text-slate-700",children:"お名前:"})," ",r.jsx("span",{className:"text-sm text-slate-900",children:v})]}),D&&(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm font-medium text-slate-700",children:"電話番号:"})," ",r.jsx("span",{className:"text-sm text-slate-900",children:D})]})]}),I&&r.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:r.jsx("p",{className:"text-sm text-red-700",children:I})}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>m(4),className:"flex-1 px-4 py-3 bg-white text-brand-text border border-brand-border rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:ring-offset-2 transition-all",children:"戻る"}),r.jsx("button",{onClick:G,disabled:S,className:"flex-1 px-4 py-3 bg-brand-primary text-white rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary focus:ring-offset-2 disabled:bg-brand-muted disabled:cursor-not-allowed transition-all",children:S?"予約中...":"予約確定"})]})]}),6===c&&F&&(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-start",children:[r.jsx("svg",{className:"w-5 h-5 text-green-600 mr-2 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h3",{className:"text-sm font-semibold text-green-900 mb-2",children:"予約が完了しました"}),(0,r.jsxs)("div",{className:"text-sm text-green-700 space-y-1",children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"font-medium",children:"予約ID:"})," ",F.reservationId]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"font-medium",children:"日付:"})," ",F.date]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"font-medium",children:"時間:"})," ",F.time]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"font-medium",children:"お名前:"})," ",F.name]})]})]})]})}),r.jsx("button",{onClick:()=>{m(1),u(t),h("any"),y(null),w(""),k(""),T(null),$(null)},className:"w-full px-4 py-3 bg-brand-primary text-white rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary focus:ring-offset-2 transition-all",children:"新しい予約をする"})]})]})}t(228),t(2988)},228:(e,s,t)=>{},4271:(e,s,t)=>{t.d(s,{default:()=>a});var r=t(2064);function a({children:e}){return r.jsx("div",{className:"min-h-screen bg-brand-bg flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"w-full max-w-[520px] bg-white rounded-3xl shadow-soft overflow-hidden",children:[(0,r.jsxs)("div",{className:"bg-brand-header px-8 py-6",children:[r.jsx("div",{className:"text-xs font-medium text-white/80 uppercase tracking-wider mb-1",children:"HAIR SALON"}),r.jsx("h1",{className:"text-2xl font-bold text-white",children:"Lumiere 表参道"})]}),r.jsx("div",{className:"px-8 py-8",children:e})]})})}},2988:(e,s,t)=>{t(8146)}};