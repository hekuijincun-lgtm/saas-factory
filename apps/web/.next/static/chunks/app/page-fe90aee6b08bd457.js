(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5627:function(e,t,s){Promise.resolve().then(s.bind(s,5691))},5691:function(e,t,s){"use strict";s.d(t,{default:function(){return E}});var a=s(5853),r=s(4254),n=s(7176),l=s(2619),i=s(645),d=s(1182),c=s(9528),o=s(7798),m=s(3790),x=s(6659),u=s(6734),b=s(2043),h=s(6780),p=s(3035);let f=(0,p.Z)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var j=s(9452);let g=(0,p.Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),v=(0,p.Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var y=s(3838);function N(){let[e,t]=(0,r.useState)(!1),[s,n]=(0,r.useState)(""),[l,i]=(0,r.useState)("");(0,r.useEffect)(()=>{t(!0);let e=new Date().toISOString().split("T")[0];n(e),i(e)},[]);let[d,c]=(0,r.useState)("all"),[p,N]=(0,r.useState)(""),[w,k]=(0,r.useState)([]),[C,Z]=(0,r.useState)([]),[S,M]=(0,r.useState)(!1),[I,T]=(0,r.useState)(null),[E,D]=(0,r.useState)(null),[F,O]=(0,r.useState)(null),[G,H]=(0,r.useState)(null),L=(0,r.useCallback)(async()=>{M(!0),T(null);try{let e=await (0,o.IF)(l);Array.isArray(e.reservations)?k(e.reservations):(console.warn("fetchReservations: response.reservations is not an array, setting to empty array"),k([]))}catch(e){T(e instanceof m.GY?e.message:e instanceof Error?e.message:"Failed to fetch reservations"),k([])}finally{M(!1)}},[l]);(0,r.useEffect)(()=>{l&&L()},[l,L]),(0,r.useEffect)(()=>{(async()=>{try{let e=await (0,y.BH)();H(e)}catch(e){console.warn("Failed to fetch settings:",e)}})()},[]),(0,r.useEffect)(()=>{let e=[...w];if("all"!==d&&("reserved"===d||(e=[])),p.trim()){let t=p.toLowerCase();e=e.filter(e=>{var s;return e.name.toLowerCase().includes(t)||(null===(s=e.phone)||void 0===s?void 0:s.toLowerCase().includes(t))||e.reservationId.toLowerCase().includes(t)})}Z(e)},[w,d,p]);let Y=e=>{if(!G)return{canCancel:!0};let t=new Date("".concat(e.date,"T").concat(e.time,":00+09:00")),s=new Date,a=new Date(s.getTime()+6e4*s.getTimezoneOffset()+324e5);return(t.getTime()-a.getTime())/6e4<G.rules.cancelMinutes?{canCancel:!1,reason:"キャンセル期限（".concat(G.rules.cancelMinutes,"分前）を過ぎています")}:{canCancel:!0}},z=async e=>{let t=Y(e);if(!t.canCancel){T(t.reason||"キャンセルできません");return}if(window.confirm("予約をキャンセルしますか？\n日付: ".concat(e.date,"\n時間: ").concat(e.time,"\nお名前: ").concat(e.name))){D(e.reservationId);try{await (0,o.Ml)(e.reservationId),await L(),O(null)}catch(e){if(e instanceof m.GY&&404===e.status)await L(),O(null);else if(e instanceof m.GY&&409===e.status){let t=e.message||"";t.includes("already canceled")||t.includes("既にキャンセル")?(T("既にキャンセル済みです"),await L(),O(null)):T(e.message||"キャンセル期限を過ぎています")}else T(e instanceof m.GY?e.message:e instanceof Error?e.message:"Failed to cancel reservation")}finally{D(null)}}},A=e=>(0,a.jsx)(b.Z,{variant:"reserved",children:"予約済み"}),P=[{key:"time",label:"時刻",render:e=>(0,a.jsx)("span",{className:"font-medium text-brand-text",children:e.time})},{key:"name",label:"顧客",render:e=>(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-brand-text",children:e.name}),e.phone&&(0,a.jsx)("div",{className:"text-sm text-brand-muted",children:e.phone})]})},{key:"menu",label:"メニュー",render:()=>(0,a.jsx)("span",{className:"text-brand-muted",children:"-"})},{key:"staff",label:"担当",render:()=>(0,a.jsx)("span",{className:"text-brand-muted",children:"-"})},{key:"status",label:"ステータス",render:e=>A(e)},{key:"actions",label:"操作",render:e=>{let t=Y(e);return(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),O(e)},className:"p-1.5 text-brand-muted hover:text-brand-primary hover:bg-brand-bg rounded-lg transition-all",title:"詳細",children:(0,a.jsx)(f,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),z(e)},disabled:E===e.reservationId||!t.canCancel,className:"p-1.5 text-rose-600 hover:text-rose-700 hover:bg-rose-50 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:t.reason||"キャンセル",children:(0,a.jsx)(j.Z,{className:"w-4 h-4"})})]})}}];return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(h.Z,{title:"予約管理",subtitle:"予約の一覧と管理を行います。",right:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("button",{onClick:()=>{console.log("CSV export - TODO")},className:"px-4 py-2 text-sm font-medium text-brand-text bg-white border border-brand-border rounded-xl hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:ring-offset-2 transition-all flex items-center gap-2",children:[(0,a.jsx)(g,{className:"w-4 h-4"}),"CSVエクスポート"]}),(0,a.jsxs)("button",{onClick:L,disabled:S,className:"px-4 py-2 text-sm font-medium text-brand-text bg-white border border-brand-border rounded-xl hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2",children:[(0,a.jsx)(v,{className:"w-4 h-4 ".concat(S?"animate-spin":"")}),"更新"]})]})}),(0,a.jsx)(x.Z,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"date",className:"block text-sm font-medium text-brand-text mb-2",children:"日付"}),(0,a.jsx)("input",{id:"date",type:"date",value:l,onChange:e=>i(e.target.value),className:"w-full px-4 py-3 border border-brand-border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:border-brand-primary transition-all"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-brand-text mb-2",children:"ステータス"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("select",{id:"status",value:d,onChange:e=>c(e.target.value),disabled:!0,className:"w-full px-4 py-3 border border-brand-border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:border-brand-primary transition-all bg-white disabled:bg-brand-bg disabled:cursor-not-allowed disabled:opacity-60",children:[(0,a.jsx)("option",{value:"all",children:"すべて"}),(0,a.jsx)("option",{value:"reserved",children:"予約済み"}),(0,a.jsx)("option",{value:"completed",children:"完了"}),(0,a.jsx)("option",{value:"canceled",children:"キャンセル"})]}),(0,a.jsx)("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-brand-muted",children:"準備中"})]}),(0,a.jsx)("p",{className:"mt-1 text-xs text-brand-muted",children:"ステータス機能は準備中です"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"search",className:"block text-sm font-medium text-brand-text mb-2",children:"検索"}),(0,a.jsx)("input",{id:"search",type:"text",value:p,onChange:e=>N(e.target.value),placeholder:"顧客名・電話・予約ID",className:"w-full px-4 py-3 border border-brand-border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:border-brand-primary transition-all"})]})]})}),I&&(0,a.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-2xl",children:(0,a.jsx)("p",{className:"text-sm text-red-700",children:I})}),(0,a.jsx)(x.Z,{children:(0,a.jsx)(u.Z,{columns:P,data:C,keyExtractor:e=>e.reservationId,loading:S,emptyMessage:"予約がありません",onRowClick:e=>O(e)})}),F&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>O(null),children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-soft max-w-2xl w-full p-6 space-y-6",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-brand-text",children:"予約詳細"}),(0,a.jsxs)("p",{className:"text-sm text-brand-muted mt-1",children:["予約ID: ",F.reservationId]})]}),(0,a.jsx)("button",{onClick:()=>O(null),className:"p-2 text-brand-muted hover:text-brand-text hover:bg-brand-bg rounded-lg transition-all",children:(0,a.jsx)(j.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-brand-muted mb-1",children:"日付"}),(0,a.jsx)("p",{className:"text-base text-brand-text",children:F.date})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-brand-muted mb-1",children:"時間"}),(0,a.jsx)("p",{className:"text-base text-brand-text",children:F.time})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-brand-muted mb-1",children:"お名前"}),(0,a.jsx)("p",{className:"text-base text-brand-text",children:F.name})]}),F.phone&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-brand-muted mb-1",children:"電話番号"}),(0,a.jsx)("p",{className:"text-base text-brand-text",children:F.phone})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-brand-muted mb-1",children:"作成日時"}),(0,a.jsx)("p",{className:"text-base text-brand-text",children:(t=>{if(!e)return t;try{return new Date(t).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(e){return t}})(F.createdAt)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-brand-muted mb-1",children:"ステータス"}),(0,a.jsx)("div",{children:A(F)})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-2 pt-4 border-t border-brand-border",children:(()=>{let e=Y(F);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>{O(null),z(F)},disabled:E===F.reservationId||!e.canCancel,title:e.reason,className:"px-4 py-2 text-sm font-medium text-rose-600 bg-rose-50 border border-rose-200 rounded-xl hover:bg-rose-100 focus:outline-none focus:ring-2 focus:ring-rose-500/20 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:E===F.reservationId?"キャンセル中...":"キャンセル"}),!e.canCancel&&e.reason&&(0,a.jsx)("p",{className:"text-xs text-rose-600 ml-2",children:e.reason})]})})()})]})})]})}var w=s(2842),k=s(1283);let C=(0,p.Z)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),Z=["日","月","火","水","木","金","土"];function S(){let[e,t]=(0,r.useState)(null),[s,n]=(0,r.useState)(!1),[l,i]=(0,r.useState)(!1),[d,c]=(0,r.useState)(null),[u,b]=(0,r.useState)({openTime:"10:00",closeTime:"18:00",slotIntervalMin:60,closedWeekdays:[0],timezone:"Asia/Tokyo"}),p=async()=>{n(!0),c(null);try{let e=await (0,o.Gw)();t(e),b(e)}catch(e){c(e instanceof m.GY?e.message:e instanceof Error?e.message:"Failed to fetch settings")}finally{n(!1)}};(0,r.useEffect)(()=>{p()},[]);let f=async()=>{if(!/^\d{2}:\d{2}$/.test(u.openTime)){c("営業開始時間はHH:mm形式で入力してください");return}if(!/^\d{2}:\d{2}$/.test(u.closeTime)){c("営業終了時間はHH:mm形式で入力してください");return}if(u.slotIntervalMin<=0){c("時間枠間隔は1分以上である必要があります");return}i(!0),c(null);try{let e=await (0,o.VP)(u);t(e),c(null)}catch(e){c(e instanceof m.GY?e.message:e instanceof Error?e.message:"Failed to update settings")}finally{i(!1)}},j=e=>{b(t=>{let s=t.closedWeekdays.includes(e)?t.closedWeekdays.filter(t=>t!==e):[...t.closedWeekdays,e];return{...t,closedWeekdays:s}})};return s?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(h.Z,{title:"管理者設定",subtitle:"システム設定を変更します。"}),(0,a.jsx)(x.Z,{children:(0,a.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-primary"}),(0,a.jsx)("span",{className:"ml-3 text-sm text-brand-muted",children:"読み込み中..."})]})})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(h.Z,{title:"管理者設定",subtitle:"システム設定を変更します。",right:(0,a.jsxs)("button",{onClick:f,disabled:l,className:"px-4 py-2 bg-brand-primary text-white rounded-xl font-medium hover:shadow-md transition-all flex items-center gap-2 disabled:bg-brand-muted disabled:cursor-not-allowed",children:[(0,a.jsx)(C,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:l?"保存中...":"保存"})]})}),d&&(0,a.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-2xl",children:(0,a.jsx)("p",{className:"text-sm text-red-700",children:d})}),(0,a.jsx)(x.Z,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-brand-text mb-2",children:"営業開始時間 *"}),(0,a.jsx)("input",{type:"time",value:u.openTime,onChange:e=>b({...u,openTime:e.target.value}),className:"w-full px-4 py-3 border border-brand-border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:border-brand-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-brand-text mb-2",children:"営業終了時間 *"}),(0,a.jsx)("input",{type:"time",value:u.closeTime,onChange:e=>b({...u,closeTime:e.target.value}),className:"w-full px-4 py-3 border border-brand-border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:border-brand-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-brand-text mb-2",children:"時間枠間隔（分） *"}),(0,a.jsx)("input",{type:"number",value:u.slotIntervalMin,onChange:e=>b({...u,slotIntervalMin:parseInt(e.target.value)||60}),className:"w-full px-4 py-3 border border-brand-border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:border-brand-primary",min:"1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-brand-text mb-2",children:"定休日"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:Z.map((e,t)=>(0,a.jsx)("button",{onClick:()=>j(t),className:"px-4 py-2 rounded-xl border transition-all ".concat(u.closedWeekdays.includes(t)?"bg-red-50 border-red-200 text-red-700":"bg-white border-brand-border text-brand-text hover:border-brand-primary"),children:e},t))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-brand-text mb-2",children:"タイムゾーン"}),(0,a.jsx)("input",{type:"text",value:u.timezone,onChange:e=>b({...u,timezone:e.target.value}),className:"w-full px-4 py-3 border border-brand-border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:border-brand-primary",placeholder:"Asia/Tokyo"})]})]})})]})}let M={dashboard:{title:"ダッシュボード",subtitle:"今日の店舗状況のサマリーです。"},reservations:{title:"予約管理",subtitle:"予約の一覧と管理を行います。"},menus:{title:"メニュー管理",subtitle:"メニューの追加・編集を行います。"},staff:{title:"スタッフ管理",subtitle:"スタッフの追加・編集を行います。"},settings:{title:"管理者設定",subtitle:"システム設定を変更します。"}};function I(){let[e,t]=(0,r.useState)("dashboard"),s=M[e];return(0,a.jsx)(l.Z,{sidebar:(0,a.jsx)(d.Z,{activeTab:e,setTab:t}),topbar:(0,a.jsx)(i.Z,{title:s.title,subtitle:s.subtitle}),children:(()=>{switch(e){case"dashboard":return(0,a.jsx)(c.Z,{});case"reservations":return(0,a.jsx)(N,{});case"menus":return(0,a.jsx)(w.Z,{});case"staff":return(0,a.jsx)(k.Z,{});case"settings":return(0,a.jsx)(S,{});default:return null}})()})}var T=s(1817);function E(){let[e,t]=(0,r.useState)("booking");return"admin"===e?(0,a.jsx)(I,{}):(0,a.jsx)(T.default,{children:(0,a.jsx)(n.default,{})})}},9528:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(5853),r=s(6659),n=s(6780);function l(){return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(n.Z,{title:"ダッシュボード",subtitle:"今日の店舗状況のサマリーです。"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[(0,a.jsx)(r.Z,{children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-blue-50 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCC5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-brand-muted mb-1",children:"本日の予約数"}),(0,a.jsx)("p",{className:"text-2xl font-semibold text-brand-text",children:"12"})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-1 px-2 py-1 bg-green-50 rounded-md",children:(0,a.jsx)("span",{className:"text-xs font-medium text-green-700",children:"+20%"})})]})}),(0,a.jsx)(r.Z,{children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-green-50 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCB0"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-brand-muted mb-1",children:"売上見込み"}),(0,a.jsx)("p",{className:"text-2xl font-semibold text-brand-text",children:"\xa584,000"})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-1 px-2 py-1 bg-green-50 rounded-md",children:(0,a.jsx)("span",{className:"text-xs font-medium text-green-700",children:"+5%"})})]})}),(0,a.jsx)(r.Z,{children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-purple-50 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-2xl",children:"⏰"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-brand-muted mb-1",children:"空き枠"}),(0,a.jsx)("p",{className:"text-2xl font-semibold text-brand-text",children:"8"})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-1 px-2 py-1 bg-slate-50 rounded-md",children:(0,a.jsx)("span",{className:"text-xs font-medium text-slate-600",children:"-"})})]})})]})]})}},2842:function(e,t,s){"use strict";s.d(t,{Z:function(){return b}});var a=s(5853),r=s(4254),n=s(7798),l=s(3790),i=s(6659),d=s(6780),c=s(6734),o=s(2043),m=s(857),x=s(7935),u=s(9452);function b(){let[e,t]=(0,r.useState)([]),[s,b]=(0,r.useState)(!1),[h,p]=(0,r.useState)(null),[f,j]=(0,r.useState)(!1),[g,v]=(0,r.useState)(null),[y,N]=(0,r.useState)({name:"",price:0,durationMin:60,active:!0,sortOrder:0}),w=async()=>{b(!0),p(null);try{let e=await (0,n.r7)();Array.isArray(e)?t(e):(console.warn("fetchMenu: menu is not an array, setting to empty array"),t([]))}catch(e){p(e instanceof l.GY?e.message:e instanceof Error?e.message:"Failed to fetch menu"),t([])}finally{b(!1)}};(0,r.useEffect)(()=>{w()},[]);let k=e=>{v(e),N({name:e.name,price:e.price,durationMin:e.durationMin,active:e.active,sortOrder:e.sortOrder}),j(!0)},C=async()=>{if(!y.name.trim()){p("メニュー名は必須です");return}if(y.price<0){p("価格は0以上である必要があります");return}if(y.durationMin<=0){p("所要時間は1分以上である必要があります");return}b(!0),p(null);try{g?await (0,n.Uf)(g.id,{name:y.name.trim(),price:y.price,durationMin:y.durationMin,active:y.active,sortOrder:y.sortOrder}):await (0,n.LW)({name:y.name.trim(),price:y.price,durationMin:y.durationMin,active:y.active,sortOrder:y.sortOrder}),await w(),j(!1)}catch(e){p(e instanceof l.GY?e.message:e instanceof Error?e.message:"Failed to save menu item")}finally{b(!1)}},Z=async e=>{b(!0),p(null);try{await (0,n.Uf)(e.id,{active:!e.active}),await w()}catch(e){p(e instanceof l.GY?e.message:e instanceof Error?e.message:"Failed to update menu item")}finally{b(!1)}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(d.Z,{title:"メニュー管理",subtitle:"メニューの追加・編集を行います。",right:(0,a.jsxs)("button",{onClick:()=>{v(null),N({name:"",price:0,durationMin:60,active:!0,sortOrder:e.length}),j(!0)},className:"px-4 py-2 bg-brand-primary text-white rounded-xl font-medium hover:shadow-md transition-all flex items-center gap-2",children:[(0,a.jsx)(m.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"追加"})]})}),h&&(0,a.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-2xl",children:(0,a.jsx)("p",{className:"text-sm text-red-700",children:h})}),(0,a.jsx)(i.Z,{children:s&&0===e.length?(0,a.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-primary"}),(0,a.jsx)("span",{className:"ml-3 text-sm text-brand-muted",children:"読み込み中..."})]}):(0,a.jsx)(c.Z,{headers:["メニュー名","価格","所要時間","状態","操作"],rows:e.map(e=>[e.name,"\xa5".concat(e.price.toLocaleString()),"".concat(e.durationMin,"分"),(0,a.jsx)(o.Z,{variant:e.active?"success":"muted",children:e.active?"有効":"無効"},"status"),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>k(e),className:"p-2 text-brand-primary hover:bg-brand-bg rounded-lg transition-all",title:"編集",children:(0,a.jsx)(x.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>Z(e),className:"p-2 text-brand-muted hover:bg-brand-bg rounded-lg transition-all",title:e.active?"無効化":"有効化",children:(0,a.jsx)(u.Z,{className:"w-4 h-4"})})]},"actions")])})}),f&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>j(!1),children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-soft max-w-md w-full p-6 space-y-4",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-brand-text",children:g?"メニューを編集":"メニューを追加"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-brand-text mb-2",children:"メニュー名 *"}),(0,a.jsx)("input",{type:"text",value:y.name,onChange:e=>N({...y,name:e.target.value}),className:"w-full px-4 py-3 border border-brand-border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:border-brand-primary",placeholder:"メニュー名"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-brand-text mb-2",children:"価格 *"}),(0,a.jsx)("input",{type:"number",value:y.price,onChange:e=>N({...y,price:parseInt(e.target.value)||0}),className:"w-full px-4 py-3 border border-brand-border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:border-brand-primary",min:"0",placeholder:"0"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-brand-text mb-2",children:"所要時間（分） *"}),(0,a.jsx)("input",{type:"number",value:y.durationMin,onChange:e=>N({...y,durationMin:parseInt(e.target.value)||60}),className:"w-full px-4 py-3 border border-brand-border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:border-brand-primary",min:"1",placeholder:"60"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"active",checked:y.active,onChange:e=>N({...y,active:e.target.checked}),className:"w-4 h-4 text-brand-primary border-brand-border rounded focus:ring-brand-primary"}),(0,a.jsx)("label",{htmlFor:"active",className:"text-sm text-brand-text",children:"有効"})]}),(0,a.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,a.jsx)("button",{onClick:()=>j(!1),className:"flex-1 px-4 py-3 bg-white text-brand-text border border-brand-border rounded-xl font-medium hover:shadow-md transition-all",children:"キャンセル"}),(0,a.jsx)("button",{onClick:C,disabled:s||!y.name.trim(),className:"flex-1 px-4 py-3 bg-brand-primary text-white rounded-xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary focus:ring-offset-2 disabled:bg-brand-muted disabled:cursor-not-allowed transition-all",children:s?"保存中...":"保存"})]})]})})]})}}},function(e){e.O(0,[856,269,283,530,285,749,744],function(){return e(e.s=5627)}),_N_E=e.O()}]);