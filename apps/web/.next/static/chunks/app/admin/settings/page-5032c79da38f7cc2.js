(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[140],{2020:function(e,t,r){Promise.resolve().then(r.bind(r,6683)),Promise.resolve().then(r.bind(r,8745)),Promise.resolve().then(r.bind(r,9100))},6683:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var n=r(5853),s=r(4254),a=r(9916);function i(){let e=(0,a.useSearchParams)(),[t,r]=(0,s.useState)(null),[i,l]=(0,s.useState)(!1),[o,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)(null),[f,h]=(0,s.useState)(null);(0,s.useEffect)(()=>{let t=e.get("success"),r=e.get("error");if("line_connected"===t){h("LINE連携が完了しました");let e=new URL(window.location.href);e.searchParams.delete("success"),window.history.replaceState({},"",e.toString())}if(r){u(r);let e=new URL(window.location.href);e.searchParams.delete("error"),window.history.replaceState({},"",e.toString())}},[e]);let m=async()=>{u(null),d(!0);try{let t=new URLSearchParams({tenantId:"default"}),r=await fetch("/api/proxy/admin/line/auth-url?".concat(t.toString()),{method:"GET",cache:"no-store"});if(!r.ok)throw Error("Request failed with status ".concat(r.status));let n=await r.json();if(!n.ok||!n.url){var e;throw Error(null!==(e=n.error)&&void 0!==e?e:"LINE auth-url is missing")}window.location.href=n.url}catch(e){u(e instanceof Error?e.message:"LINE連携の開始に失敗しました"),console.error("Failed to start LINE auth flow",e)}finally{d(!1)}},[x,b]=(0,s.useState)(!1),p=async()=>{try{b(!0),u(null),await p();return}catch(t){var e;u(String(null!==(e=null==t?void 0:t.message)&&void 0!==e?e:t))}finally{b(!1)}};return(0,s.useEffect)(()=>{p()},[]),(0,n.jsxs)("main",{className:"p-6 max-w-3xl mx-auto space-y-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold",children:"Admin Settings"}),f&&(0,n.jsx)("div",{className:"rounded-md border border-green-200 bg-green-50 px-4 py-2 text-sm text-green-800",children:f}),c&&(0,n.jsx)("div",{className:"rounded-md border border-red-200 bg-red-50 px-4 py-2 text-sm text-red-800",children:c}),(0,n.jsxs)("section",{className:"rounded-xl border border-gray-200 bg-white p-4 space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"font-medium",children:"LINE 連携"}),(0,n.jsx)("p",{className:"text-xs text-gray-500",children:"予約通知や自動営業のために、LINE公式アカウントと接続します。"})]}),(0,n.jsx)("span",{className:"text-xs px-2 py-1 rounded-full border bg-gray-50",children:i||!t?"確認中...":"linked"===t.kind||"connected"===t.kind?"連携済み":"unconfigured"===t.kind?"未設定":"未連携"})]}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,n.jsx)("button",{onClick:m,disabled:o,className:"px-4 py-2 text-sm rounded-lg border border-gray-300 bg-white hover:bg-gray-50 disabled:opacity-50",children:(null==t?void 0:t.kind)==="connected"?o?"再連携中...":"LINEを再連携する":o?"連携中...":"LINEと連携する"}),(0,n.jsx)("button",{onClick:p,disabled:x,className:"px-3 py-2 text-xs rounded-lg border border-gray-200 bg-gray-50 hover:bg-gray-100 disabled:opacity-50",children:"ステータス再取得"})]}),(null==t?void 0:t.kind)==="disconnected"&&"expired"===t.reason&&(0,n.jsx)("p",{className:"text-xs text-amber-600",children:"連携の有効期限が切れています。もう一度「LINEと連携する」を押して再接続してください。"})]})]})}},9916:function(e,t,r){"use strict";var n=r(2535);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},8745:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return s}});let n=r(5463);function s(e){let{reason:t,children:r}=e;if("undefined"==typeof window)throw new n.BailoutToCSRError(t);return r}},9100:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return a}});let n=r(5853),s=r(3865);function a(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let r=(0,s.getExpectedRequestStore)("next/dynamic css"),a=[];if(r.reactLoadableManifest&&t){let e=r.reactLoadableManifest;for(let r of t){if(!e[r])continue;let t=e[r].files.filter(e=>e.endsWith(".css"));a.push(...t)}}return 0===a.length?null:(0,n.jsx)(n.Fragment,{children:a.map(e=>(0,n.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:r.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}}},function(e){e.O(0,[285,749,744],function(){return e(e.s=2020)}),_N_E=e.O()}]);