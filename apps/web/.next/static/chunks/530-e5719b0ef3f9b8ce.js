"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[530],{7176:function(e,t,s){s.d(t,{default:function(){return m}});var r=s(5853),n=s(4254),a=s(7798),l=s(3790),i=s(1354),d=s(3838);function o(e){if(!e)return new Date;if(e instanceof Date)return isNaN(e.getTime())?new Date:e;if("string"==typeof e){if(!e.trim())return new Date;let t=new Date(e);if(!isNaN(t.getTime()))return t;let s=e.match(/^(\d{4})\/(\d{1,2})\/(\d{1,2})$/);if(s){let[,e,t,r]=s,n=new Date(parseInt(e),parseInt(t)-1,parseInt(r));if(!isNaN(n.getTime()))return n}let r=e.match(/^(\d{4})\.(\d{1,2})\.(\d{1,2})$/);if(r){let[,e,t,s]=r,n=new Date(parseInt(e),parseInt(t)-1,parseInt(s));if(!isNaN(n.getTime()))return n}let n=e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);if(n){let[,e,t,s]=n,r=new Date(parseInt(e),parseInt(t)-1,parseInt(s));if(!isNaN(r.getTime()))return r}}return new Date}function c(e){let t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(s,"-").concat(r)}function m(){var e,t,s,m,x;let[u,f]=(0,n.useState)(!1),[b,h]=(0,n.useState)(""),[p,g]=(0,n.useState)(1),[y,j]=(0,n.useState)("");(0,n.useEffect)(()=>{f(!0);let e=c(new Date);h(e),j(e)},[]);let[N,v]=(0,n.useState)("any"),[w,k]=(0,n.useState)([]),[S,D]=(0,n.useState)([]),[C,F]=(0,n.useState)(null),[I,A]=(0,n.useState)(""),[T,E]=(0,n.useState)(""),[O,G]=(0,n.useState)(!1),[M,R]=(0,n.useState)(null),[Y,H]=(0,n.useState)(null),[J,L]=(0,n.useState)(null),[W,_]=(0,n.useState)(!0);(0,n.useEffect)(()=>{(async()=>{_(!0);try{let e=await (0,d.BH)();L(e)}catch(e){console.warn("Failed to fetch settings, using defaults:",e)}finally{_(!1)}})()},[]),(0,n.useEffect)(()=>{(async()=>{try{let e=await (0,a.Dh)();Array.isArray(e)?k(e):(console.warn("fetchStaff: staff is not an array, using fallback"),k(i.G.filter(e=>"any"!==e.id).map(e=>({id:e.id,name:e.name,role:e.role,active:!0,sortOrder:0}))))}catch(e){console.warn("Failed to fetch staff, using fallback:",e),k(i.G.filter(e=>"any"!==e.id).map(e=>({id:e.id,name:e.name,role:e.role,active:!0,sortOrder:0})))}})()},[]),(0,n.useEffect)(()=>{3===p&&y?(async()=>{G(!0),R(null),D([]);try{let e=await (0,a.FJ)(y,"any"!==N?N:void 0);e&&e.slots&&Array.isArray(e.slots)?D(e.slots):(console.warn("getSlots: Invalid response format",e),D([]),R("スロットデータの形式が不正です"))}catch(e){R(e instanceof l.GY?e.message:e instanceof Error?e.message:"Failed to fetch slots"),D([]),console.error("Failed to fetch slots:",e)}finally{G(!1)}})():(D([]),R(null))},[y,N,p]);let B=async()=>{if(!C||!I.trim()){R("時間と名前を入力してください");return}G(!0),R(null);try{let e=await (0,a.Rr)({date:y,time:C,name:I.trim(),phone:T.trim()||void 0,staffId:"any"!==N?N:null});H(e),R(null),g(6)}catch(e){if(e instanceof l.GY&&409===e.status){R("その枠は埋まりました。別の時間を選択してください。"),g(3);try{let e=await (0,a.FJ)(y,"any"!==N?N:void 0);D(e.slots)}catch(e){console.error("Failed to refresh slots:",e)}}else R(e instanceof l.GY?e.message:e instanceof Error?e.message:"Failed to create reservation")}finally{G(!1)}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"flex items-center justify-between mb-6",children:[1,2,3,4,5,6].map(e=>(0,r.jsxs)("div",{className:"flex items-center flex-1",children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-xl flex items-center justify-center text-sm font-medium ".concat(p>=e?"bg-brand-primary text-white":"bg-brand-bg text-brand-muted"),children:e}),e<6&&(0,r.jsx)("div",{className:"flex-1 h-1 mx-2 rounded ".concat(p>e?"bg-brand-primary":"bg-brand-border")})]},e))}),1===p&&(0,r.jsx)("div",{className:"space-y-4",children:W?(0,r.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-primary"}),(0,r.jsx)("span",{className:"ml-3 text-sm text-brand-muted",children:"読み込み中..."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-brand-text mb-1",children:"予約日を選択"}),(0,r.jsx)("p",{className:"text-sm text-brand-muted",children:"ご希望の日付を選択してください"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"date",className:"block text-sm font-medium text-brand-text mb-2",children:"予約日"}),(0,r.jsx)("input",{id:"date",type:"date",value:y,onChange:e=>{let t=e.target.value;if(J){var s,r,n,a,l;let e=o(b),i=o(t),d=null!==(l=null!==(a=J.publicDays)&&void 0!==a?a:null===(s=J.rules)||void 0===s?void 0:s.publicDays)&&void 0!==l?l:0,c=new Date(e);if(c.setDate(e.getDate()+d),isNaN(e.getTime())||isNaN(i.getTime())||isNaN(c.getTime())){R("日付の処理中にエラーが発生しました");return}if(i<e||i>c){R("予約可能期間は今日から".concat(d,"日後までです"));return}let m=i.getDay();if(null===(r=J.closedWeekdays)||void 0===r?void 0:r.includes(m)){R("選択された日付は定休日です");return}let x=null===(n=J.exceptions)||void 0===n?void 0:n.find(e=>e.date===t);if(x&&"closed"===x.type){R("選択された日付は休業日です");return}}j(t),R(null)},className:"w-full px-4 py-3 border border-brand-border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:border-brand-primary transition-all",min:u?c(o(b)):void 0,max:u&&J?(()=>{var e,t,s;let r=o(b),n=null!==(s=null!==(t=J.publicDays)&&void 0!==t?t:null===(e=J.rules)||void 0===e?void 0:e.publicDays)&&void 0!==s?s:0,a=new Date(r);return(a.setDate(r.getDate()+n),isNaN(a.getTime()))?c(r):c(a)})():void 0}),J&&(0,r.jsxs)("p",{className:"text-xs text-brand-muted mt-1",children:["予約可能期間: 今日から",null!==(x=null!==(m=J.publicDays)&&void 0!==m?m:null===(e=J.rules)||void 0===e?void 0:e.publicDays)&&void 0!==x?x:0,"日後まで"]})]}),M&&(0,r.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-xl",children:(0,r.jsx)("p",{className:"text-sm text-red-700",children:M})}),(0,r.jsx)("button",{onClick:()=>{y&&g(2)},disabled:!y||!!M,className:"w-full px-4 py-3 bg-brand-primary text-white rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:ring-offset-2 disabled:bg-brand-muted disabled:cursor-not-allowed transition-all",children:"次へ"})]})}),2===p&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-brand-text mb-1",children:"スタッフを選択"}),(0,r.jsx)("p",{className:"text-sm text-brand-muted",children:"指名なしも選べます（あとで割当可能）"})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("button",{onClick:()=>v("any"),className:"w-full px-4 py-4 rounded-2xl text-left border transition-all ".concat("any"===N?"bg-white border-brand-primary shadow-md ring-2 ring-brand-primary/20":"bg-white border-brand-border shadow-sm hover:shadow-md hover:border-brand-primary"),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"font-medium text-brand-text",children:"指名なし"}),(0,r.jsx)("span",{className:"text-xs px-2 py-0.5 bg-blue-50 text-blue-700 rounded-md",children:"おすすめ"})]}),(0,r.jsx)("div",{className:"text-sm text-brand-muted mt-1",children:"後からスタッフを割り当て可能"})]}),w.length>0?w.map(e=>(0,r.jsxs)("button",{onClick:()=>v(e.id),className:"w-full px-4 py-4 rounded-2xl text-left border transition-all ".concat(N===e.id?"bg-white border-brand-primary shadow-md ring-2 ring-brand-primary/20":"bg-white border-brand-border shadow-sm hover:shadow-md hover:border-brand-primary"),children:[(0,r.jsx)("div",{className:"font-medium text-brand-text",children:e.name}),e.role&&(0,r.jsx)("div",{className:"text-sm text-brand-muted mt-1",children:e.role})]},e.id)):(0,r.jsx)("div",{className:"text-sm text-brand-muted text-center py-4",children:"スタッフ情報を読み込み中..."})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>g(1),className:"flex-1 px-4 py-3 bg-white text-brand-text border border-brand-border rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:ring-offset-2 transition-all",children:"戻る"}),(0,r.jsx)("button",{onClick:()=>{g(3)},className:"flex-1 px-4 py-3 bg-brand-primary text-white rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:ring-offset-2 transition-all",children:"次へ"})]})]}),3===p&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-brand-text mb-1",children:"時間を選択"}),(0,r.jsx)("p",{className:"text-sm text-brand-muted",children:"ご希望の時間を選択してください"})]}),O&&(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-brand-primary"}),(0,r.jsx)("span",{className:"mt-4 text-sm text-brand-muted",children:"時間枠を取得中..."}),(0,r.jsx)("span",{className:"mt-1 text-xs text-brand-muted",children:"しばらくお待ちください"})]}),!O&&M&&(0,r.jsxs)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-red-800 mb-1",children:"エラーが発生しました"}),(0,r.jsx)("p",{className:"text-sm text-red-700",children:M}),(0,r.jsx)("button",{onClick:async()=>{R(null),G(!0);try{let e=await (0,a.FJ)(y,"any"!==N?N:void 0);e&&e.slots&&Array.isArray(e.slots)?D(e.slots):(R("スロットデータの形式が不正です"),D([]))}catch(e){R(e instanceof l.GY?e.message:e instanceof Error?e.message:"Failed to fetch slots"),D([])}finally{G(!1)}},className:"mt-3 px-4 py-2 bg-red-100 text-red-700 rounded-lg text-sm font-medium hover:bg-red-200 transition-colors",children:"再試行"})]}),!O&&!M&&0===S.length&&(0,r.jsxs)("div",{className:"p-6 bg-slate-50 border border-slate-200 rounded-xl text-center",children:[(0,r.jsx)("p",{className:"text-sm text-brand-muted",children:"選択された日付には予約可能な時間枠がありません"}),(0,r.jsx)("p",{className:"text-xs text-brand-muted mt-1",children:"別の日付を選択してください"})]}),!O&&!M&&S.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"grid grid-cols-3 gap-2",children:S.map(e=>{let t=!e.available,s={cutoff:"締切",reserved:"予約済",shift:"勤務外/休憩",closed:"休業"};return(0,r.jsx)("button",{onClick:()=>!t&&F(e.time),disabled:t,className:"px-4 py-2.5 rounded-2xl text-sm font-medium transition-all border relative ".concat(C===e.time?"bg-white text-brand-text border-brand-primary shadow-md ring-2 ring-brand-primary/20":t?"bg-slate-50 text-brand-muted border-brand-border opacity-60 cursor-not-allowed":"bg-white text-brand-text border-brand-border shadow-sm hover:shadow-md hover:border-brand-primary"),children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-0.5",children:[(0,r.jsx)("span",{children:e.time}),t&&e.reason&&s[e.reason]&&(0,r.jsx)("span",{className:"text-xs text-rose-600 font-normal",children:s[e.reason]})]})},e.time)})}),J&&y===b&&(null===(t=J.rules)||void 0===t?void 0:t.cutoffMinutes)&&(0,r.jsxs)("p",{className:"text-xs text-brand-muted mt-2",children:["当日は",J.rules.cutoffMinutes,"分前まで予約可能です"]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>g(2),className:"flex-1 px-4 py-3 bg-white text-brand-text border border-brand-border rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:ring-offset-2 transition-all",children:"戻る"}),(0,r.jsx)("button",{onClick:()=>{C&&g(4)},disabled:!C,className:"flex-1 px-4 py-3 bg-brand-primary text-white rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary focus:ring-offset-2 disabled:bg-brand-muted disabled:cursor-not-allowed transition-all",children:"次へ"})]})]}),4===p&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-brand-text mb-1",children:"お客様情報"}),(0,r.jsx)("p",{className:"text-sm text-brand-muted",children:"予約に必要な情報を入力してください"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"name",className:"block text-sm font-medium text-brand-text mb-2",children:["お名前 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{id:"name",type:"text",value:I,onChange:e=>A(e.target.value),placeholder:"山田 太郎",className:"w-full px-4 py-3 border border-brand-border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:border-brand-primary transition-all"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-brand-text mb-2",children:"電話番号（任意）"}),(0,r.jsx)("input",{id:"phone",type:"tel",value:T,onChange:e=>E(e.target.value),placeholder:"090-1234-5678",className:"w-full px-4 py-3 border border-brand-border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:border-brand-primary transition-all"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>g(3),className:"flex-1 px-4 py-3 bg-white text-brand-text border border-brand-border rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:ring-offset-2 transition-all",children:"戻る"}),(0,r.jsx)("button",{onClick:()=>{I.trim()&&g(5)},disabled:!I.trim(),className:"flex-1 px-4 py-3 bg-brand-primary text-white rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary focus:ring-offset-2 disabled:bg-brand-muted disabled:cursor-not-allowed transition-all",children:"次へ"})]})]}),5===p&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-brand-text mb-1",children:"予約内容の確認"}),(0,r.jsx)("p",{className:"text-sm text-brand-muted",children:"内容をご確認の上、予約を確定してください"})]}),(0,r.jsxs)("div",{className:"bg-slate-50 rounded-lg p-4 space-y-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-sm font-medium text-slate-700",children:"日付:"})," ",(0,r.jsx)("span",{className:"text-sm text-slate-900",children:y})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-sm font-medium text-slate-700",children:"スタッフ:"})," ",(0,r.jsx)("span",{className:"text-sm text-slate-900",children:"any"===N?"指名なし":(null===(s=w.find(e=>e.id===N))||void 0===s?void 0:s.name)||"指名なし"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-sm font-medium text-slate-700",children:"時間:"})," ",(0,r.jsx)("span",{className:"text-sm text-slate-900",children:C})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-sm font-medium text-slate-700",children:"お名前:"})," ",(0,r.jsx)("span",{className:"text-sm text-slate-900",children:I})]}),T&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-sm font-medium text-slate-700",children:"電話番号:"})," ",(0,r.jsx)("span",{className:"text-sm text-slate-900",children:T})]})]}),M&&(0,r.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,r.jsx)("p",{className:"text-sm text-red-700",children:M})}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>g(4),className:"flex-1 px-4 py-3 bg-white text-brand-text border border-brand-border rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:ring-offset-2 transition-all",children:"戻る"}),(0,r.jsx)("button",{onClick:B,disabled:O,className:"flex-1 px-4 py-3 bg-brand-primary text-white rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary focus:ring-offset-2 disabled:bg-brand-muted disabled:cursor-not-allowed transition-all",children:O?"予約中...":"予約確定"})]})]}),6===p&&Y&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("svg",{className:"w-5 h-5 text-green-600 mr-2 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-green-900 mb-2",children:"予約が完了しました"}),(0,r.jsxs)("div",{className:"text-sm text-green-700 space-y-1",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"予約ID:"})," ",Y.reservationId]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"日付:"})," ",Y.date]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"時間:"})," ",Y.time]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"お名前:"})," ",Y.name]})]})]})]})}),(0,r.jsx)("button",{onClick:()=>{g(1),j(b),v("any"),F(null),A(""),E(""),H(null),R(null)},className:"w-full px-4 py-3 bg-brand-primary text-white rounded-2xl font-medium hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-primary focus:ring-offset-2 transition-all",children:"新しい予約をする"})]})]})}},1354:function(e,t,s){s.d(t,{G:function(){return r}});let r=[{id:"any",name:"指名なし",role:"Any"},{id:"sakura",name:"サクラ",role:"Top Stylist"},{id:"kenji",name:"ケンジ",role:"Director"},{id:"rookie",name:"Rookie",role:"Staff"}]},1817:function(e,t,s){s.d(t,{default:function(){return n}});var r=s(5853);function n(e){let{children:t}=e;return(0,r.jsx)("div",{className:"min-h-screen bg-brand-bg flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"w-full max-w-[520px] bg-white rounded-3xl shadow-soft overflow-hidden",children:[(0,r.jsxs)("div",{className:"bg-brand-header px-8 py-6",children:[(0,r.jsx)("div",{className:"text-xs font-medium text-white/80 uppercase tracking-wider mb-1",children:"HAIR SALON"}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Lumiere 表参道"})]}),(0,r.jsx)("div",{className:"px-8 py-8",children:t})]})})}},3838:function(e,t,s){s.d(t,{BH:function(){return a}});var r=s(3790);let n={publicDays:14,tenant:{name:"",email:""},businessHours:{openTime:"10:00",closeTime:"19:00"},closedWeekdays:[0],exceptions:[],rules:{cutoffMinutes:120,cancelMinutes:1440,anyCapacityPerSlot:1},notifications:{enableAdminNotify:!1,slackWebhookUrl:"",email:"",enableCustomerNotify:!1},assignment:{mode:"manual",strategy:"priority",priorityOrder:[]},integrations:{line:{connected:!1,notifyOnReservation:!0,notifyOnCancel:!0,notifyOnReminder:!1},stripe:{connected:!1}}};async function a(){try{let e=await (0,r.R1)("/admin/settings");if(e.ok&&e.data)return l(e.data,n);throw Error(e.error||"Failed to fetch settings")}catch(e){return console.warn("Failed to fetch settings from API, trying localStorage:",e),function(){try{let e=localStorage.getItem("lumiere.adminSettings");if(e){let t=JSON.parse(e);return l(t,n)}}catch(e){console.warn("Failed to load from localStorage:",e)}return n}()}}function l(e,t){if(!e)return t;let s={...t};for(let[r,n]of Object.entries(e)){if(null==n)continue;let e=t[r],a="object"==typeof n&&null!==n&&!Array.isArray(n),i="object"==typeof e&&null!==e&&!Array.isArray(e);a&&i?s[r]=l(n,e):s[r]=n}return s}}}]);